---
title: "Defining Endmemebrs from LIA data"
output: rmarkdown::html_vignette
vignette: >
  <!-- %\VignetteIndexEntry{endmembers} -->
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: "/home/kd/PARA/Notes/My Library.bib"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = ""
)
```

# Introduction

Lead isotope analysis is a widely employed technique for determining the provenance of ancient artifacts, achieved by comparing the lead (Pb) isotope ratios of an artifact with those of known ore deposits. However, a significant limitation of this method arises from the complexity of ancient metallurgy. It is improbable that all metal at a given archaeological site originated from a single ore source, and the historical practice of recycling and mixing metals further complicates analysis. Consequently, when metals from two distinct ore sources are combined, the resulting Pb isotope ratios deviate from those of the original sources. This phenomenon is graphically represented as a “mixing line,” which plots the isotopic composition of the mixed metal between the two or more
parent ore sources [@Stos-Gale01].

To mitigate the complexities introduced by metal mixing, [@E.E.Y+19] proposed a methodology utilizing "end-members" from a sample group.
End-members are defined as the samples that lie at the extremes of a mixing line, and they are presumed to represent unmixed metals with the most direct relationship to their parent ore sources.
In cases where two primary ore sources are involved in the metal mixture, this approach allows for the clear distinction of three distinct groups: the two end-member groups, which correspond to the unmixed parent materials, and a third group representing the samples that are a result of the mixing process between the two.

A major challenge for reproducibility has been the visual identification of endmember clusters. To address this, \textcite{A.D.G+24} proposed a method using *Principal Component Analysis (PCA)* on <sup>204</sup>Pb-normalized data to determine the number of endmembers in a sample set. This approach maps the maximum and minimum values of the principal component to the isotope vectors. However, this method is limited as it only identifies two points, which are unlikely to fully represent all endmembers.

A more robust approach is required. Samples from the same ore body share the same geological age and consequently align along a single isochron. While the two-stage model [@S.K75] provides an imperfect representation of isotopic age, the true distribution of samples from an endmember set follows the slope of the geochron. Therefore, a more accurate definition of endmembers involves identifying them as a set of vectors that lie near a line parallel to the geochron, passing through the principal vector mapped to either the minimum or maximum values of the first principal component of the entire data set. This refined method enables the identification of a comprehensive set of samples that constitute an endmember group.

Trends in the three dimensional space of 
<sup>206</sup>Pb/<sup>204</sup>Pb-
<sup>207</sup>Pb/<sup>204</sup>Pb-
<sup>208</sup>Pb/<sup>204</sup>Pb
, is determined by the principle component analysis scores of each vector $\vec{p}_{i}$ as $[c_1, c_2, c_3]$ using the \texttt{stat::prcomp()} function.
The collection of vectors is considered to represent mixing between two end members, $c_a$ and $c_b$, when $c_1$ explains 95\% of the variance of the group,
where:

$$
	(c_{a} = \min c_{1}) \mapsto \vec{p_{a}} \;and\;
	(c_{b} = \max c_{1}) \mapsto \vec{p_{b}}
$$

While, $\vec{p_{a}}$ and $\vec{p_{b}}$ represent the most distinct ends of the set, additional end members can be identified using $\vec{p_i}$.

A vector $\vec{e_i}$, as defined above,  is considered an endmember if it lies within tolerance of $\varepsilon$ from the line $\overline{p_i}$ which passes through $\vec{p_i}$ parallel to the geocron  in the Cartesian plane of $\left(\frac{^{206}\text{Pb}}{^{204}\text{Pb}},\frac{^{207}\text{Pb}}{^{204}\text{Pb}}\right)$

$$
f(\vec{e}, \vec{p}) = |e_2 - (p_1 - (S\times p_2))| < \varepsilon
$$
Where $S$ is the slope of the geochron.
In this study the values for $\varepsilon$ was chosen to be 0.01.
This value was manually set for optimal results based on trial and error, and can be further refined based on the data.

This results in the creation for two sets of endmembers $E_a$ and $E_b$, where:

$$
	E_i = \left\{\vec{p_i}, \vec{e_i^1},\ldots, \vec{e_i^n}\right\}
$$
However, if $|E_i| < 2$ then it is difficult to consider only $\vec{p_i} \in E_i$ as an endmember, and so $p_i$ is considered only a possible end member.

Defining endmembers as distinct groups is not always precise, yet is preferable than analyzing individual data-points separately, as it provides a more structured and meaningful interpretation of isotopic variability [@E.E.Y+19].
Then, assuming that the endmembers reflects a single ore, the provenance is suggested based on the highest probability of the cluster, considering all the results.

# Functions

## Endmembers Function

Using the `endmembers()` function we get list of 8, which includes the data itself and three major groups.
Two endmembers, and one mixing group.
```{r setup}
library(liaendmembers)

end_members <- endmembers(tel_dor, names(tel_dor))

```

## Summary Function

The data can be summarized using the `summary()` function

```{r summary}
summary(end_members)
```
